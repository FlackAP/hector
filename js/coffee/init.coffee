root = @

# event sys
events = {}
onEvent = (eventName, eventHandler) ->
  events[eventName] ?= []
  events[eventName].push eventHandler
  ->
    events[eventName].splice events[eventName].indexOf(eventHandler), 1
fireEvent = (eventName, args...) ->
  if events[eventName]?.length
    for eventHandler in events[eventName]
      eventHandler(args...)

@sprites = sprites =
{"face":{"actions":{"skin":{"frames":["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACoAAAA6CAYAAADGFcvAAAABNklEQVRoQ+3aUQ6CMAwGYHcI7+WFfPJC3stDaEbSZQKja9fB36Q+A375qWO2pNvg5/N+fSWXuD+eSXI8Has6SYpbwzRYEXQU2EqyB94NnYUkPIdlobOBdcpH2EPomUgO3IRehWyVAiw0g+tS2IVeneZeGWygSMi6DHxCEdOkWi2JoiI3z3oXUHRkTnW59QHVbDwb50SihmEul0oe6jOg1rc9Eo1EZyRgfc1YnswTjU2JcaSxKTEONDbOpoHmjomLGi1Q9CXKJxQ1Vero/fWeEP+WuIAe9keRUnUBXQ8eYPujLBTl1+8CujdvgpyKuIC2pndQiboZMaqhZ64ALqbLHLL08Lnt+MzHag+yGzqrBHqRIqg1VoIUQ62wUqQKSvWsrVsNcggqTVcLpGDYl1+4FYEDjwLp+39qHtWc5f6nZgAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACYAAAAzCAYAAAD7JnqGAAABJUlEQVRYR+3Z4Q0CIQwFYFnArZzJGZzJrVxAwyUQxAJtOcozqX/l9Mu7AkcvXCY+r+fjPbr8eruH0Rjqe/FFHAz1R1IgG6YF1UgukAU7C1UiR8AhbAUqAXu4JmwliJMcCbNC9ZL7gVmjWjgYWASWNfcF25UWlVqG7UbVOGwYSlplakdiDmM+ZsTZCZlY9Ae025hCdRizvPIwT8wTkyYgHe815olJE5COx90rER97jk0cEQb72JNhaKk5TLJUpEMv1IG3PI1Dwf6rRZDqYNfhpG7iQfTH6k5PXvnrWWOdGtXy3N7qpNJqJma5E7QaxN2u9epbqupaW8xSSNj0C4gV9TZCdYt/1RLCQYlgZyTHRYlhMzgJSgXT4KQoNaysv95apwGl3/4APZLBGq6++gkAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAuCAYAAAA/SqkPAAAA6UlEQVRYR+2Y4Q3EIAiF61rd6ibpVrdWL5poelYEioBJ7W/tx3u0BAgb8zm/x9m6EvZP4LyKfBgC1jBqACiYCuQG0AU/heYgeupBsBSKwZvgUdAe/AYeDYXgZuAYwDXnf2AttS3VBawNreG+YCu1V9VJ8WvA6Qv3UJzA1jaXPC8wp4uQnF05lrjHurusZtklOexXMj1qdWyBXBS/GGyZ59zi+jZ7root4HNNErn8abZCoGJNu+shfZ75WMPy1kpirlXESNXQAma+rY9UNbZoQxds3F8MA5bZido3UQoLFVrGVCocUs8BZtYPRA2vZuRC5CMAAAAASUVORK5CYII="]},"mouth":{"frames":["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAECAYAAABodtTSAAAAJklEQVQYV2M8VJrz3657CiMDmQCkH6yZXINg+qhnCMw1pPoIFgwAmXMap4CjQnIAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAACCAYAAACHSIaUAAAAH0lEQVQIW2M8VJrz3657CiMDiQCkD6wJxCBRLwPIQgATpgqlQ0dZqgAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAABCAYAAAA4u0VhAAAAEElEQVQIW2M8VJrzn4FCAACvSAKkaqtKXQAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAACCAYAAAC+LzfPAAAAIUlEQVQIW2NkAIJDpTn/QTQ5wK57CiMjyAAQgxwDYA4AAMg1CqWvauu0AAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAAECAYAAABV5LW0AAAAK0lEQVQIW2NkgIJDpTn/YWxctF33FEaQHJgAaYAJ4NMIU8dIrAZkF5GlCQAGahlJD4Y4xQAAAABJRU5ErkJggg=="]},"ears":{"frames":["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC4AAAANCAYAAADWgVyvAAAAYklEQVRIS2N8sKL2PwMSUIhoZkTmDxY2ujsZ0QVADh1sjsfmRqwOH0yOx+ZokPtGHU6rvDAa4rQKWVzmjob4aIgTGQI4kwpI/2CuhHC5DVy9D/ZqH5v74O0SZMnBXOXD3AYA/OpeNv4mjFoAAAAASUVORK5CYII="]},"nose":{"frames":["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAPCAYAAADZCo4zAAAAcUlEQVQYV2NkQAKvNzT/B3FFA2oZYcJwBkiAaAXIpmCYcP3oSwZNa3G4NXAFMOPxKgBJggBOE3AqQDYeZgLMoWA3UKYAXTcsBGEOZcSnAKQYrADmeuR4gTkWHlCHSnPAEQUDdt1TwHIoQQ1TBJMEKQAAc3FYStOrSO4AAAAASUVORK5CYII="]},"eye_whites":{"frames":["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAFCAYAAACuNHcwAAAAK0lEQVQYV2NkAIKnT+/9B9EwIC2txIjMJ4aNzQxGdEFyLMBlxhA2nJZhDgCkOCb7SrxlvQAAAABJRU5ErkJggg=="]},"pupils":{"frames":["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAABCAYAAADTjP5iAAAAFklEQVQIW2M0MzP7f+rUKUYGCgDIDAAUCgWjuVjQ7AAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAECAYAAABhnXSoAAAAKklEQVQYV2NkAAIzM7P/IPrUqVOMIJocgGwGI4wDM4gcg9HNoI2htPA+AIo1G0cHpildAAAAAElFTkSuQmCC"]},"eyebrows":{"frames":["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABsAAAACCAYAAACpDacGAAAAKElEQVQIW2NkQAKhrpb/kfmrdx9nROYTw0Y2A10/I7oF6AaSYiEhswCsPw3VDopBvwAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABsAAAAICAYAAAAIloRgAAAAWUlEQVQoU2NkIABCXS3/r959nJGQOmLkcRoCsgRkALEWEeMoDMtglpBiEcxXhByIYhkhxcQEFT7Hgi2jxDe4HIDN4YzU8A2xFlIlleELXmTP0NwyWDSBUjUAx2E0CURot4sAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAHCAYAAADj/NY7AAAASklEQVQoU2MMdbX8zwAEq3cfZwTR1AAwM8EGUtMCZLPgroUJUuILdEdiBAU5vsDlMKzhTIoF+NTijESQJkKRTMgReFMIPguIsRwACzU12k7DDSsAAAAASUVORK5CYII="]},"eyelids":{"frames":["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAHCAYAAAD9NeaIAAAAOUlEQVQoU2NkgILXG5r/w9ggWjSglhGZTwwblxlgg9AlYQaSYhE+MxhxSZJiESEzhpEldIkTeqQuAFv0NV9Bp5PrAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAHCAYAAADnCQYGAAAAKklEQVQoU2N8vaH5PwMSEA2oZUTmE8NGN4NkA4ixZNRQYkKJNDWMtIh9AAo+DkJjIYPbAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAHCAYAAADj/NY7AAAANUlEQVQoU2NkAILXG5r/g2gYEA2oZUTmE8PGZgYjuiA5FuAyg2QXEuMLmJohbDjNw5xWqQUARPAeQlFRGIkAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAHCAYAAAD9NeaIAAAARUlEQVQoU2NkgILXG5r/w9ggWjSglhGZTwwblxkkG0SMZehqhpEl6OGI7lVi4oaQGeDgwqWIGAtwJRyYOMgMeJzQMnUBAJnsHyXwfP54AAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAHCAYAAAD9NeaIAAAAPklEQVQoU2NkgILXG5r/w9ggWjSglhGZTwwblxlgg9AlYQaSYhE+MxhxSZJiESEzSA4SYoINXc0wtISWqQsA19wfJbZ8PhMAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAHCAYAAAD9NeaIAAAAQUlEQVQoU2NkgILXG5r/w9ggWjSglhGZTwwblxlgg9AlYQaSYhE+MxhxSZJiESEzSA4SYoINXQ39fELzOKFH6gIAI34uQka/i+sAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAHCAYAAAD9NeaIAAAAQUlEQVQoU2NkgILXG5r/w9ggWjSglhGZTwwblxlgg9AlYQaSYhE+M0h2LTE+QlfDiMsFpPiGkBn0sYSucULL1AUAVOAuQlDkeFQAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAHCAYAAAD9NeaIAAAAQElEQVQoU2NkgILXG5r/w9ggWjSglhGZTwwblxkkG0SMZehqwJaguwCmiBTf4DODEZckKRYRMoM+ltAluOiRugAssy5Csr2zKgAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAHCAYAAAD9NeaIAAAAPklEQVQoU2NkgILXG5r/w9ggWjSglhGZTwwblxlgg9AlYQaSYhE+MxhxSZJiESEz6GMJMWFNqRr6xAk9UhcA8g0uQjqOE4QAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAHCAYAAAD9NeaIAAAAQUlEQVQoU2NkgILXG5r/w9ggWjSglhGZTwwblxlgg9AlYQaSYhE+MxhxSZJiESEz6GMJXYKLmAilVA08BdEydQEAGkkuQv+5iYsAAAAASUVORK5CYII="]},"backboard":{"frames":["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEwAAABYCAYAAABf0BGmAAAEUUlEQVR4Xu2cS5LUMAyG0z2wYXgv4CIcgFtwRjacgQVLqjgHbHgVbIBqSt1lUNSyJdmy4ySezdRMO7b8+f8l59E5TB3+vHr54vT67ftDh6FNXQUFoDCkJaCFGGJjdwGMgqLKagVOs2AsMHxg7WAlWC0Ul4qBzl8EBgF7Q0sF+OT23pnR5x8/xRTmEZdmwfA4V8AstMUZoQZSYAEU7VMDzrqo0oJxYwZo/4BJE8rJK5o+Y6C4xdDCsywkbotjiUGLArNYIydAC6gW8Lh4OGhnYFQJ2oNzQMExpbC8AGrioNCugEmd5NpC6jcXfs3jPn39Pt29czMb4oDVtcZJ1QLGwYLEPwP26/ef6dmjB7ViWFW/FNisSmKVDWiXdcXA2H3YgPbfADF1QYvZxnVAS6vrChjdYuzRnil1scAwtAHs+jxaPPneEzRJXaLCoMEANt8NRS8g7rEAxLYSGNkAhmgUAdtbxdTkr2gOC9D3ZMsBzHjm6g5syxUzdmWCY568zUYvLG51i6FVlymHBdpbvGY2gBnyl8WOQ2HkulfgnLrfacph0OHWLJm6B1mU9E+n0/T0/q1B7OtpSqG5KWxr6gpLOoAZxW2xpSmH1VTYxy/fktN8/vihEYOtuVZlqqsVtZK9BCk25RrwugeWCytA9IbWLbBSUFR1XuBcgXnlLm9Y3mrTQBNvgnjlr1qwPKF1A6w2LC9oLsBK7dgKlge0Acy2FTu3xtC4UyQxh5UorLW6WqhsACMqlGwpPnaeq7Cl1OWtMvGLDV6PcA5ghgS6NKxSlaVsmbTkWu1YCixVLQewiHNi2wt3YL3YsVRlA5ghB2dbMudO9+4UBnTD1mIAu8gy+X3JAewCSZ3DBrDrbwOrFQbwrLbcQg4zbVyxwgawBs/pb01h4sl32K7kVsq1A5OeFVPdyLXksbUDM18Powpbcx6z3rOU1AUs3BUGnfaiMiswSV1JYCXVco3ANOqqBqwHlVnUZXnOVXy7U+63QZZWmRYYBwuK3Jt3H1g2JmDWArAUNC0smA8FloIlWpKrmPA/7aXr3oFZYWUD63lfplVXDiw1MFoxLdZsrTINsFxYRcB6hFYblgkYp7KeoGlg5ST5kMfDb7FK0gO4l6hpc1ote7aCZVZYrGouqbSWsLKBldrT40xAC8rDhthlZkvig0vsWQJtKVhFCvOwJ4Yv5TcLpKAq+I3fMCft4mm+5v4uUpg3NE3AmjbW80NNn9lVMtZ5qT0tQafacptSaB87mbaO66IwSWnwee1XBQKoGhakQF2Bxaon/F+7V7OuOAcqjOelKhyTOzAJmqfaYrnK04LVFZayZ/gM1FYCDkAdj4fp5niczcejCkoKr6IwPGjqfdRWm8bsB+N5vPlcggWfVweWsqglt3H2CxNsBasZMMmmKYumVNVSWWEOTRRGpR6zaQCH29N3QS+hqupVUpMLNO/a5/ppaT9u/EUUpi0KuN3SoEIsfwGxSNLkHDhTaAAAAABJRU5ErkJggg=="]}}},"hand":{"actions":{"point":{"frames":["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAASCAYAAABvqT8MAAAAaUlEQVQoU+2TyxIAIARF8/8f3YMY1WVhXauGOZUj1PDqM0wohYJ9rkbEqSf/ga2RLbEiMXXYCi35HnhQATlSvNsNd+MWaIB/hu4zYOXCk60Qd0MJSCEtvGzprk+tHXbh9w3mw8JwSDJoAFWEPg4dD6xrAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAASCAYAAABvqT8MAAAAZ0lEQVQoU8WS4Q7AMASEef+HViwa265rNU3mJz7OBVMxuNhPxwDRzXAYSooGMXvpVf8RcD2XrJu0oaRsdwYDMFdikh+NwsAORJMlVwAbOJzcD0kbtoBPKA7fdulpCrIJ/8rs3cvv3QACsDIOknFsbwAAAABJRU5ErkJggg=="]}}},"buttons":{"actions":{"eyebrows":{"frames":["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAKCAYAAABi8KSDAAAAZUlEQVQYV2NkAALHdSf+g2h8YH+QBSMjMQphhpCveKe/OQPr/98MTpvOMezzM2L4zcjK4L7xJNx1cJNBkiBF6ABZnHxnEAoR0kzW7V70X0RZjZChDG/u3mJgBKkCaSCk+nJpHCMAYEMvXoqcnNkAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAKCAYAAABi8KSDAAAAVklEQVQYV2NkAIKKo9f/g2h8oMNak5GRGIUwQ8hX3G6hAjak8sQdBmQ2hskgSZAidIAsTr4zCIUIaSZnrNn9X0BShpChDB+eP2FgBKkCaSCkekaIKyMA1cIvXpeRVh4AAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAKCAYAAABi8KSDAAAAQUlEQVQYV2NkIAEwgtQ2nrz1n5CeenM1RkZiFMIMIl9xnYkS2JCmM/cYkNkYJoMkQYrQAbI4+c4gFCKkmUxKOAMAHUsqAG/DvwMAAAAASUVORK5CYII="]},"eyelids":{"frames":["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAKCAYAAABi8KSDAAAAXUlEQVQYV2NkAALf01H/QTQ+sNl0GSMjMQphhmAo3qS/BG6B38UYFMtQFIMUIitA58MVI0vgYpNnMsxxRLuZUPAxmi5x/i+hLk5IHcOLmy8ZGEGqQBoIqT4ds5cRADZIOT1S6TirAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAKCAYAAABi8KSDAAAAXElEQVQYV2NkAILGm63/QTQ+UK9ezchIjEKYIRiK65Qq4RY03WtHsQxFMUghsgJ0PlwxsgQuNnkmwxxHtJsJBR9j/t7i/0IyQoTUMbx78o6BEaQKpIGQ6onOvYwAi0I8u122RX8AAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAKCAYAAABi8KSDAAAARklEQVQYV2NkIAEwgtR23un5T0hPuUoJIyMxCmEGYSguUyiGW9L1oBfFQhTFIIXICtD5cMXIErjY5JkMcxzRbiYUfCSFMwCLzTeb6+UA+gAAAABJRU5ErkJggg=="]},"mouth":{"frames":["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAKCAYAAABi8KSDAAAAUElEQVQYV2NkAIJHM5z/g2h8QC5jLyMjMQphhtBYsUTyHoYXc11wOhkmD3cGSAAXgBlEQzfvqDL4ryUnTCiYGa49esvACFIF0kBItUfbBUYArx4pkLUp7+sAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAKCAYAAABi8KSDAAAAUElEQVQYV2NkAIJXW4v/g2h8QMy7l5GRGIUwQ2isWNC9h+H9zhKcTobJw50BEsAFYAbR0M1n5qf+lxPjIxTMDI9efWJgBKkCaSCk2iRxNiMATwIsUczxorMAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAKCAYAAABi8KSDAAAAOklEQVQYV2NkIAEwgtS+3lXzn5AeUbcWRkZiFMIMorFiQedmhvd7a3E6GyYPdwZIABeAGURDN5MSzgAXwCbrz/IpnAAAAABJRU5ErkJggg=="]},"pupils":{"frames":["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAKCAYAAABi8KSDAAAAVklEQVQYV2NkAIKzsV7/QTQ+YLx4GyMjMQphhlCuWHfBVriLLid4w9koJoMUgSSJUgwzgiTFuEKFNA8uczX9ry4hSiiYGW6+eM3ACFIF0kBIddTu04wA07oqT0GgdvYAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAKCAYAAABi8KSDAAAAVklEQVQYV2NkAILbXTX/QTQ+oFrWwshIjEKYIZQrVihphrvoQU8tnI1iMkgRSJIoxTAjSFKMK1RI8+C+ypz/soIChIKZ4fH7DwyMIFUgDYRUO7VPYQQALJctzZGvn44AAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAKCAYAAABi8KSDAAAAQElEQVQYV2NkIAEwgtTem9z6n5AepdxqRkZiFMIMolyxXHYV3FWPprbB2SgmgxSBJIlSDDOCJMW4QoY0D5ISzgDfJii+hjaIIQAAAABJRU5ErkJggg=="]}}},"scenery":{"actions":{"wallpaper":{"frames":["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAAjElEQVQ4T8XVUQ6AIAwDUHtuvz33DCQjqGN2CMh382wImxCRYyMOgJ3NJg5MOKH6bSZPwTUawd3GFsriTdhDGdyEGfQNf8AR1MMvcA/awgv8BbXwDI9A7ziIoQtHctlpjXVER1xHPe7zX4VeZE9zazGtm7xIc2+Frt9uXnNm2f/3B6mbM01LPhKOzPYJV1udQ5ZTsREAAAAASUVORK5CYII="]},"github":{"frames":["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAoUlEQVQ4T7WTUQ7AIAhD9eYefdFEA0gLZNu+tqGPQqE3/gwQRv9br14w5y+wBcLM2UokUML2O0tgz6zvCBgIW2EF3kCrpFK6quwX4Bt1uyWHMRUy4Ix5cXgnAmZMkcYslz0DKqZ8DlTJkUKVldR9VeKNDTLCct1WsTlUG2BoqMcDrV5UMjSSAa+hFSpTQKQqM1ZqUzwTJYQBoctoMjzH6fY89gMmFeRHadgAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAApUlEQVQ4T62U2w6AMAhD3f9/tGZLWADbgpm+ObZDuY5LfzcxD/aMGRgoc17v80EXRMEe6GF2rhzkO+u/AhYpXmZzGoBZCU068BAiY6EdAU/UmeDNmEoUcNpQJ9DuqICdovjCLO+oNb7k8HdgEMQU5h5lob+iQ23TzStMlerDMAFJIt1CbPSqkGkhFdBEoYq3gKH8LsQOcN/pLFgFLBdsbg80enJ6HjOFKQ/l9ytHAAAAAElFTkSuQmCC"]}}}}

eyebrowsStates = ['flat', 'peak', 'valley']
eyelidsStates  = ['closed', 'squint', 'half', 'open']
mouthStates    = ['flat', 'happy', 'joyful', 'sad', 'sorrowful']
pupilsStates   = ['small', 'large']

loaded = false
frameCount = 0
loadedFrameCount = 0
@e = entities = []

# load resources
for spriteName, sprite of sprites
  for groupName, group of sprite.actions
    for frameIndex, frame of group.frames
      do (spriteName, sprite, groupName, group, frameIndex, frame) ->
        frameCount++
        img = document.createElement('img')
        img.onload = ->
          group.frames[frameIndex] = img
          loadedFrameCount++
          # set to true if frames are loaded
          if frameCount is loadedFrameCount
            loaded = true
            console.log 'loaded', sprites
            fireEvent 'assetsLoaded'

        img.src = frame