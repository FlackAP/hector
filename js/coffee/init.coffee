# game config

# event sys
events = {}
onEvent = (eventName, eventHandler) ->
  events[eventName] ?= []
  events[eventName].push eventHandler
  console.log events[eventName]
  ->
    events[eventName].splice events[eventName].indexOf(eventHandler), 1
    console.log events[eventName]
fireEvent = (eventName) ->
  if events[eventName].length
    for eventHandler in events[eventName]
      eventHandler()


# loading
sprites = {"face":{"groups":{"skin":{"frames":["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACoAAAA6CAYAAADGFcvAAAABNklEQVRoQ+3aUQ6CMAwGYHcI7+WFfPJC3stDaEbSZQKja9fB36Q+A375qWO2pNvg5/N+fSWXuD+eSXI8Has6SYpbwzRYEXQU2EqyB94NnYUkPIdlobOBdcpH2EPomUgO3IRehWyVAiw0g+tS2IVeneZeGWygSMi6DHxCEdOkWi2JoiI3z3oXUHRkTnW59QHVbDwb50SihmEul0oe6jOg1rc9Eo1EZyRgfc1YnswTjU2JcaSxKTEONDbOpoHmjomLGi1Q9CXKJxQ1Vero/fWeEP+WuIAe9keRUnUBXQ8eYPujLBTl1+8CujdvgpyKuIC2pndQiboZMaqhZ64ALqbLHLL08Lnt+MzHag+yGzqrBHqRIqg1VoIUQ62wUqQKSvWsrVsNcggqTVcLpGDYl1+4FYEDjwLp+39qHtWc5f6nZgAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACYAAAAzCAYAAAD7JnqGAAABJUlEQVRYR+3Z4Q0CIQwFYFnArZzJGZzJrVxAwyUQxAJtOcozqX/l9Mu7AkcvXCY+r+fjPbr8eruH0Rjqe/FFHAz1R1IgG6YF1UgukAU7C1UiR8AhbAUqAXu4JmwliJMcCbNC9ZL7gVmjWjgYWASWNfcF25UWlVqG7UbVOGwYSlplakdiDmM+ZsTZCZlY9Ae025hCdRizvPIwT8wTkyYgHe815olJE5COx90rER97jk0cEQb72JNhaKk5TLJUpEMv1IG3PI1Dwf6rRZDqYNfhpG7iQfTH6k5PXvnrWWOdGtXy3N7qpNJqJma5E7QaxN2u9epbqupaW8xSSNj0C4gV9TZCdYt/1RLCQYlgZyTHRYlhMzgJSgXT4KQoNaysv95apwGl3/4APZLBGq6++gkAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAuCAYAAAA/SqkPAAAA6UlEQVRYR+2Y4Q3EIAiF61rd6ibpVrdWL5poelYEioBJ7W/tx3u0BAgb8zm/x9m6EvZP4LyKfBgC1jBqACiYCuQG0AU/heYgeupBsBSKwZvgUdAe/AYeDYXgZuAYwDXnf2AttS3VBawNreG+YCu1V9VJ8WvA6Qv3UJzA1jaXPC8wp4uQnF05lrjHurusZtklOexXMj1qdWyBXBS/GGyZ59zi+jZ7root4HNNErn8abZCoGJNu+shfZ75WMPy1kpirlXESNXQAma+rY9UNbZoQxds3F8MA5bZido3UQoLFVrGVCocUs8BZtYPRA2vZuRC5CMAAAAASUVORK5CYII="]},"mouth":{"frames":["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAECAYAAABodtTSAAAAJklEQVQYV2M8VJrz3657CiMDmQCkH6yZXINg+qhnCMw1pPoIFgwAmXMap4CjQnIAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAACCAYAAACHSIaUAAAAH0lEQVQIW2M8VJrz3657CiMDiQCkD6wJxCBRLwPIQgATpgqlQ0dZqgAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAABCAYAAAA4u0VhAAAAEElEQVQIW2M8VJrzn4FCAACvSAKkaqtKXQAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAACCAYAAAC+LzfPAAAAIUlEQVQIW2NkAIJDpTn/QTQ5wK57CiMjyAAQgxwDYA4AAMg1CqWvauu0AAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAAECAYAAABV5LW0AAAAK0lEQVQIW2NkgIJDpTn/YWxctF33FEaQHJgAaYAJ4NMIU8dIrAZkF5GlCQAGahlJD4Y4xQAAAABJRU5ErkJggg=="]},"ears":{"frames":["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC4AAAANCAYAAADWgVyvAAAAYklEQVRIS2N8sKL2PwMSUIhoZkTmDxY2ujsZ0QVADh1sjsfmRqwOH0yOx+ZokPtGHU6rvDAa4rQKWVzmjob4aIgTGQI4kwpI/2CuhHC5DVy9D/ZqH5v74O0SZMnBXOXD3AYA/OpeNv4mjFoAAAAASUVORK5CYII="]},"nose":{"frames":["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAPCAYAAADZCo4zAAAAcUlEQVQYV2NkQAKvNzT/B3FFA2oZYcJwBkiAaAXIpmCYcP3oSwZNa3G4NXAFMOPxKgBJggBOE3AqQDYeZgLMoWA3UKYAXTcsBGEOZcSnAKQYrADmeuR4gTkWHlCHSnPAEQUDdt1TwHIoQQ1TBJMEKQAAc3FYStOrSO4AAAAASUVORK5CYII="]},"eye_whites":{"frames":["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAFCAYAAACuNHcwAAAAK0lEQVQYV2NkAIKnT+/9B9EwIC2txIjMJ4aNzQxGdEFyLMBlxhA2nJZhDgCkOCb7SrxlvQAAAABJRU5ErkJggg=="]},"pupils":{"frames":["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAABCAYAAADTjP5iAAAAFklEQVQIW2M0MzP7f+rUKUYGCgDIDAAUCgWjuVjQ7AAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAECAYAAABhnXSoAAAAKklEQVQYV2NkAAIzM7P/IPrUqVOMIJocgGwGI4wDM4gcg9HNoI2htPA+AIo1G0cHpildAAAAAElFTkSuQmCC"]},"eyebrows":{"frames":["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABsAAAACCAYAAACpDacGAAAAKElEQVQIW2NkQAKhrpb/kfmrdx9nROYTw0Y2A10/I7oF6AaSYiEhswCsPw3VDopBvwAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABsAAAAICAYAAAAIloRgAAAAWUlEQVQoU2NkIABCXS3/r959nJGQOmLkcRoCsgRkALEWEeMoDMtglpBiEcxXhByIYhkhxcQEFT7Hgi2jxDe4HIDN4YzU8A2xFlIlleELXmTP0NwyWDSBUjUAx2E0CURot4sAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAHCAYAAADj/NY7AAAASklEQVQoU2MMdbX8zwAEq3cfZwTR1AAwM8EGUtMCZLPgroUJUuILdEdiBAU5vsDlMKzhTIoF+NTijESQJkKRTMgReFMIPguIsRwACzU12k7DDSsAAAAASUVORK5CYII="]},"eyelids":{"frames":["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAHCAYAAAD9NeaIAAAAOUlEQVQoU2NkgILXG5r/w9ggWjSglhGZTwwblxlgg9AlYQaSYhE+MxhxSZJiESEzhpEldIkTeqQuAFv0NV9Bp5PrAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAHCAYAAADnCQYGAAAAKklEQVQoU2N8vaH5PwMSEA2oZUTmE8NGN4NkA4ixZNRQYkKJNDWMtIh9AAo+DkJjIYPbAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAHCAYAAADj/NY7AAAANUlEQVQoU2NkAILXG5r/g2gYEA2oZUTmE8PGZgYjuiA5FuAyg2QXEuMLmJohbDjNw5xWqQUARPAeQlFRGIkAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAHCAYAAAD9NeaIAAAARUlEQVQoU2NkgILXG5r/w9ggWjSglhGZTwwblxkkG0SMZehqhpEl6OGI7lVi4oaQGeDgwqWIGAtwJRyYOMgMeJzQMnUBAJnsHyXwfP54AAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAHCAYAAAD9NeaIAAAAPklEQVQoU2NkgILXG5r/w9ggWjSglhGZTwwblxlgg9AlYQaSYhE+MxhxSZJiESEzSA4SYoINXc0wtISWqQsA19wfJbZ8PhMAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAHCAYAAAD9NeaIAAAAQUlEQVQoU2NkgILXG5r/w9ggWjSglhGZTwwblxlgg9AlYQaSYhE+MxhxSZJiESEzSA4SYoINXQ39fELzOKFH6gIAI34uQka/i+sAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAHCAYAAAD9NeaIAAAAQUlEQVQoU2NkgILXG5r/w9ggWjSglhGZTwwblxlgg9AlYQaSYhE+M0h2LTE+QlfDiMsFpPiGkBn0sYSucULL1AUAVOAuQlDkeFQAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAHCAYAAAD9NeaIAAAAQElEQVQoU2NkgILXG5r/w9ggWjSglhGZTwwblxkkG0SMZehqwJaguwCmiBTf4DODEZckKRYRMoM+ltAluOiRugAssy5Csr2zKgAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAHCAYAAAD9NeaIAAAAPklEQVQoU2NkgILXG5r/w9ggWjSglhGZTwwblxlgg9AlYQaSYhE+MxhxSZJiESEz6GMJMWFNqRr6xAk9UhcA8g0uQjqOE4QAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAHCAYAAAD9NeaIAAAAQUlEQVQoU2NkgILXG5r/w9ggWjSglhGZTwwblxlgg9AlYQaSYhE+MxhxSZJiESEz6GMJXYKLmAilVA08BdEydQEAGkkuQv+5iYsAAAAASUVORK5CYII="]},"backboard":{"frames":["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEwAAABYCAYAAABf0BGmAAADYUlEQVR4Xu2czVEDMQyFSR0c4EILXKiDOqiFGaqiBS5woI4wBpxxHFl68l+8K3EMtiN/+/Qsezd7uFnw7+Xx/vj6/nlYMLSbpYIKoFJIK0JbAlgOKlfWTHBpLNT3ksBipxmBSrBmKK4UgxpYCHYENA7Sw93tidHH1zdrY71i4+LJv+NCYZrOGlOWlJSCyseVwGkvLBpL/N4U2glYOkgMngsUubpvz09HabIcqBpwmouYt6ViyaGxwNIBpYlrA9WAosaeGU8K7RcYpS4OQGuwrbCQi4PEKMWRjxGy6gyYNEAMFAmGmhQ6PgJkRhtqnoeorq1NZjQwCtavwvIVw8H9XQoqHcPnFx4WPnRo58DgsmK07Fcdv6Suk8Ji4NrVctUJt8aVAlNV+hZTk1PXhcJcaWWzj2zY0wprC4CkLkhhlqBVA6vZLrUa7Qr9ObNnUzIHZkVlTcCsqQxJx6KHWVwtHZjSFB2YAljpZIIagr3NZmWrhKrLPexfQg5MkY6hqQNzYEoCyuauMAemJKBs7gprBBa6l+7sex1GrJJVwCzdfutS6VsCpqnFiilpZVsU7Q41fgdW2B6VfEy8CWLltBVNSweWlCBIWorALN3MdWCNBWzVU9SWFIb4mKdkpkIpLR2YA1MaF9Fc9bhT6G+tys+ZwQ/UxY4O7PwnO+QjmxQsS1U+pzIHBthcycfEH2dZq8Oo0wtXWE+F+Sr5RxNOSQfmwIAEvGxSrTCrpYUDU+isqdK3qDD1XtK68TcDs6SyqvOwXGFWgEmwAgfovmT0y71vk5qAWVMZ+nwF/PTOnlWGwmJTsnQ+tkc/Q1Ix8hBfh0W9p2ZPXqZRF6Qwysv2ojItLNPAKFgBiPQSJjEl9+hltbBghe0pLVtgqYDtAVorLDWwrRazJVCIZ+WnQrCHpR239sBwD2XBdVjp3G0L0HoqqxnYFtKzp7K6AFsZ2ghYVaZPpehq6VlTwZesp4vp54Osst8cpap0vlWrJKKy2GbWRn2kqoYA47ZQIzfrM1Q1FFhpRzAC2mxY3Uxfk6I9UvUaoLqVFdLqgr4oWxon/v+asIYqjNtK5XCQhWFE1Y5epOEehm6nUHAcrDCGdOhXA6bUp1tZoQ1KSlVpvJmQrqawmsUh73MtUNNMX1KKVL/NTjkp3h8CAYw7WNy/OgAAAABJRU5ErkJggg=="]}}}}

root = @

loaded = false
frameCount = 0
loadedFrameCount = 0
@e = entities = []

# load resources
for spriteName, sprite of sprites
  for groupName, group of sprite.groups
    for frameIndex, frame of group.frames
      do (group, frameIndex, frame) ->
        frameCount++
        img = document.createElement('img')
        img.onload = ->
          group.frames[frameIndex] = img
          loadedFrameCount++
          # set to true if frames are loaded
          if frameCount is loadedFrameCount
            loaded = true
            console.log 'loaded', sprites
            fireEvent 'assetsLoaded'
        img.src = frame